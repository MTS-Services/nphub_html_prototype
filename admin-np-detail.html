<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NP / Job Seeker Detail - NP Clinical Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
    --color-primary: #0A2540;
    --color-primary-dark: #021426;
    --color-secondary: #FFD700;
    --color-bg: #ECECEC;
    --color-white: #FFFF;
    --color-text: #2D2D2D;
    --border-radius: 8px;
    --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    --transition: 0.3s ease;
    }
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }
    html, body {
    height: 100%;
    width: 100%;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
    overflow: hidden;
    }
    body {
    display: flex;
    flex-direction: column;
    }
    .header {
    background: var(--color-primary);
    color: var(--color-white);
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
    flex-shrink: 0;
    }
    .header h1 {
    font-size: 1.5rem;
    }
    .header-right {
    display: flex;
    gap: 12px;
    align-items: center;
    }
    .logout-btn {
    background: transparent;
    color: var(--color-white);
    border: 1px solid var(--color-white);
    padding: 8px 16px;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background var(--transition);
    user-select: none;
    }
    .logout-btn:hover {
    background: rgba(255,255,255,0.2);
    }
    .main {
    display: flex;
    flex: 1 1 auto;
    height: calc(100vh - 64px);
    width: 100vw;
    overflow: hidden;
    background: var(--color-bg);
    }
    nav.sidebar {
    width: 280px;
    background: var(--color-primary-dark);
    color: var(--color-white);
    padding: 24px 0;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    height: 100%;
    box-sizing: border-box;
    }
    .sidebar-section {
    margin-bottom: 24px;
    flex-shrink: 0;
    }
    .sidebar-section h3 {
    padding-left: 24px;
    margin-bottom: 12px;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    color: rgba(255,255,255,0.7);
    user-select: none;
    }
    .nav-item {
    display: block;
    padding: 12px 24px;
    color: var(--color-white);
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: background var(--transition), border-color var(--transition);
    cursor: pointer;
    user-select: none;
    }
    .nav-item:hover,
    .nav-item.active {
    background: var(--color-primary);
    border-left-color: var(--color-secondary);
    }
    main.content {
    flex-grow: 1;
    padding: 32px 40px;
    overflow-y: auto;
    background: var(--color-white);
    display: flex;
    flex-direction: column;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    width: calc(100vw - 280px);
    box-sizing: border-box;
    }
    .back-btn {
    align-self: flex-start;
    background: #95a5a6;
    color: var(--color-white);
    border: none;
    padding: 10px 20px;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 24px;
    transition: background-color var(--transition);
    user-select: none;
    }
    .back-btn:hover {
    background-color: #7f8c8d;
    }
    .profile-card {
    display: flex;
    gap: 24px;
    margin-bottom: 32px;
    align-items: center;
    }
    .profile-photo {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: #cfd8dc url('https://i.pravatar.cc/120?img=47') center/cover no-repeat;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    flex-shrink: 0;
    }
    .profile-info {
    flex: 1;
    }
    .profile-info h2 {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--color-primary);
    }
    .profile-info p {
    font-size: 1rem;
    color: #555;
    margin-bottom: 6px;
    }
    .profile-info p strong {
    color: var(--color-primary);
    }
    .status {
    display: inline-block;
    padding: 6px 18px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
    margin-top: 12px;
    }
    .status.new {
    background-color: #3498db;
    color: white;
    }
    .status.review {
    background-color: #f39c12;
    color: white;
    }
    .status.interviewed {
    background-color: #9b59b6;
    color: white;
    }
    .status.hired {
    background-color: #27ae60;
    color: white;
    }
    .status.rejected {
    background-color: #e74c3c;
    color: white;
    }
    /* Pill Tabs */
    .content-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 32px;
    background: #f1f3f6;
    padding: 6px;
    border-radius: 999px;
    align-self: flex-start;
    flex-wrap: wrap;
    }
    .content-tab {
    border: none;
    outline: none;
    background: transparent;
    color: #555;
    font-size: 1.05rem;
    font-weight: 500;
    padding: 8px 28px;
    border-radius: 999px;
    cursor: pointer;
    transition:
    background var(--transition),
    color var(--transition),
    box-shadow var(--transition),
    font-weight var(--transition);
    box-shadow: none;
    position: relative;
    margin-bottom: 0;
    }
    .content-tab.active {
    background: var(--color-white);
    color: var(--color-primary);
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    z-index: 1;
    }
    .content-tab:not(.active):hover,
    .content-tab:not(.active):focus-visible {
    background: #e9ecef;
    color: var(--color-primary);
    outline: none;
    }
    /* Tab content */
    .tab-content {
    margin-top: 0;
    min-height: 200px;
    }
    .tab-content[hidden] {
    display: none;
    }
    /* Sections styling */
    .section-list {
    list-style: none;
    padding-left: 0;
    margin-top: 12px;
    }
    .section-list li {
    margin-bottom: 8px;
    font-size: 1rem;
    color: #444;
    }
    table {
    width: 100%;
    border-collapse: collapse;
    background: var(--color-white);
    border-radius: var(--border-radius);
    overflow: hidden;
    margin-top: 16px;
    }
    th, td {
    padding: 12px;
    text-align: left;
    border-top: 1px solid #ddd;
    color: var(--color-primary);
    }
    th {
    background: var(--color-bg);
    font-weight: 600;
    }
    /* Communication log */
    .comm-log {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    padding: 12px;
    background: #f9fbfd;
    font-size: 0.95rem;
    color: #444;
    }
    .comm-entry {
    margin-bottom: 12px;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
    }
    .comm-entry:last-child {
    border-bottom: none;
    }
    .comm-entry strong {
    color: var(--color-primary);
    }
    /* Quick actions */
    .quick-actions {
    margin-top: 24px;
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    }
    .quick-actions button {
    flex: 1 1 180px;
    padding: 10px 20px;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    user-select: none;
    transition: background-color var(--transition);
    }
    .btn-primary {
    background-color: var(--color-secondary);
    color: var(--color-primary-dark);
    }
    .btn-primary:hover,
    .btn-primary:focus-visible {
    background-color: #e6c200;
    outline: none;
    }
    .btn-success {
    background-color: #27ae60;
    color: var(--color-white);
    }
    .btn-success:hover,
    .btn-success:focus-visible {
    background-color: #1e8449;
    outline: none;
    }
    .btn-warning {
    background-color: #f39c12;
    color: var(--color-white);
    }
    .btn-warning:hover,
    .btn-warning:focus-visible {
    background-color: #d78e0a;
    outline: none;
    }
    /* Engagement subtabs */
    #engagements .content-tabs {
    margin-bottom: 16px;
    }
    .engagement-subtab-content {
    margin-top: 12px;
    }
    @media (max-width: 900px) {
    .main {
    flex-direction: column;
    height: auto;
    }
    nav.sidebar {
    width: 100%;
    height: auto;
    padding: 16px 0;
    max-height: none;
    }
    main.content {
    width: 100% !important;
    padding: 24px 16px;
    border-radius: 0;
    box-shadow: none;
    }
    .profile-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
    }
    .profile-info h2 {
    margin-top: 16px;
    }
    .content-tabs {
    justify-content: space-around;
    gap: 8px;
    }
    .quick-actions {
    flex-direction: column;
    }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>NP / Job Seeker Detail</h1>
    <div class="header-right">
    <span>Admin User</span>
    <button class="logout-btn" onclick="window.location.href='index.html'">Logout</button>
    </div>
  </div>

  <div class="main">
    <nav class="sidebar" aria-label="Admin navigation">
    <div class="sidebar-section">
    <h3>People</h3>
    <a href="admin-md-collaborators.html" class="nav-item">üë®‚Äç‚öïÔ∏è MD Collaborators</a>
    <a href="admin-nps.html" class="nav-item active">ü©∫ NPs / Job Seekers</a>
    <a href="admin-students.html" class="nav-item">üéì Students</a>
    <a href="admin-program-coordinators.html" class="nav-item">üë©‚Äçüíº Program Coordinators</a>
    <a href="admin-preceptors.html" class="nav-item">üë®‚Äç‚öïÔ∏è Preceptors</a>
    </div>
    <div class="sidebar-section">
    <h3>Services</h3>
    <a href="admin-rotation-applications.html" class="nav-item">üìù Rotations</a>
    <a href="admin-job-applications.html" class="nav-item">üìÑ Job Applications</a>
    <a href="admin-job-postings.html" class="nav-item">üìã Job Postings</a>
    <a href="admin-scheduling.html" class="nav-item">üìÖ Scheduling</a>
    <a href="admin-billing.html" class="nav-item">üí≥ Billing</a>
    <a href="admin-messaging.html" class="nav-item">üí¨ Messaging</a>
    <a href="admin-md-collaborations.html" class="nav-item">ü§ù MD Collaborations</a>
    <a href="admin-practice-launchpad.html" class="nav-item">üöÄ Practice Launchpad</a>
    <a href="admin-launchpad-service-packages.html" class="nav-item">üì¶ Service Packages</a>
    </div>
    <div class="sidebar-section">
    <h3>Organization</h3>
    <a href="admin-clinics.html" class="nav-item">üè• Clinics</a>
    <a href="admin-institutions.html" class="nav-item">üè´ Institutions</a>
    <a href="admin-programs.html" class="nav-item">üìã Programs</a>
    </div>
    <div class="sidebar-section">
    <h3>System</h3>
    <a href="admin-dashboard.html" class="nav-item">üè† Dashboard</a>
    <a href="admin-reports.html" class="nav-item">üìä Reports</a>
    <a href="admin-settings.html" class="nav-item">‚öôÔ∏è Settings</a>
    </div>
    </nav>

    <main class="content" role="main">
    <button class="back-btn" onclick="window.location.href='admin-nps.html'">‚Üê Back to List</button>

    <section class="profile-card" aria-label="NP profile summary">
    <div class="profile-photo" role="img" aria-label="Profile photo"></div>
    <div class="profile-info">
    <h2 id="npName">Loading...</h2>
    <p><strong>Specialty:</strong> <span id="npSpecialty">-</span></p>
    <p><strong>Credentials:</strong> <span id="npCredentials">-</span></p>
    <p><strong>Contact Email:</strong> <a href="#" id="npEmail">-</a></p>
    <p><strong>Phone:</strong> <a href="#" id="npPhone">-</a></p>
    <p><strong>Location:</strong> <span id="npLocation">-</span></p>
    <p><strong>Willing to Relocate:</strong> <span id="npRelocate">-</span></p>
    <p><strong>Years of Experience:</strong> <span id="npExperience">-</span></p>
    <p><strong>Status:</strong> <span id="npStatus" class="status">-</span></p>
    </div>
    </section>

    <nav class="content-tabs" role="tablist" aria-label="NP detail sections">
    <button class="content-tab active" role="tab" aria-selected="true" aria-controls="jobPreferences" id="tab-jobPreferences" tabindex="0">Job Preferences</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="education" id="tab-education" tabindex="-1">Education & Training</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="workHistory" id="tab-workHistory" tabindex="-1">Work History</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="licenses" id="tab-licenses" tabindex="-1">Licenses & Certifications</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="documents" id="tab-documents" tabindex="-1">Documents</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="applicationStatus" id="tab-applicationStatus" tabindex="-1">Application Status & Notes</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="communication" id="tab-communication" tabindex="-1">Communication & Actions</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="engagements" id="tab-engagements" tabindex="-1">Engagements</button>
    </nav>

    <section id="jobPreferences" class="tab-content" role="tabpanel" aria-labelledby="tab-jobPreferences">
    <h3>Job Preferences</h3>
    <ul class="section-list">
    <li><strong>Desired Job Type:</strong> <span id="jobType">-</span></li>
    <li><strong>Preferred Practice Settings:</strong> <span id="practiceSettings">-</span></li>
    <li><strong>Availability / Start Date:</strong> <span id="availability">-</span></li>
    <li><strong>Salary Expectations:</strong> <span id="salary">-</span></li>
    </ul>
    </section>

    <section id="education" class="tab-content" role="tabpanel" aria-labelledby="tab-education" hidden>
    <h3>Education & Training</h3>
    <ul class="section-list" id="educationList"></ul>
    </section>

    <section id="workHistory" class="tab-content" role="tabpanel" aria-labelledby="tab-workHistory" hidden>
    <h3>Work History</h3>
    <ul class="section-list" id="workHistoryList"></ul>
    </section>

    <section id="licenses" class="tab-content" role="tabpanel" aria-labelledby="tab-licenses" hidden>
    <h3>Licenses & Certifications</h3>
    <ul class="section-list" id="licensesList"></ul>
    </section>

    <section id="documents" class="tab-content" role="tabpanel" aria-labelledby="tab-documents" hidden>
    <h3>Documents</h3>
    <ul class="section-list" id="documentsList"></ul>
    </section>

    <section id="applicationStatus" class="tab-content" role="tabpanel" aria-labelledby="tab-applicationStatus" hidden>
    <h3>Application Status & Notes</h3>
    <p><strong>Status:</strong> <span id="applicationStatusText">-</span></p>
    <p><strong>Admin Notes:</strong></p>
    <p id="adminNotes">-</p>
    </section>

    <section id="communication" class="tab-content" role="tabpanel" aria-labelledby="tab-communication" hidden>
    <h3>Communication & Actions</h3>
    <div class="comm-log" tabindex="0" aria-label="Communication history" id="communicationLog"></div>
    <div class="quick-actions">
    <button class="btn btn-primary" onclick="alert('Schedule Interview clicked')">Schedule Interview</button>
    <button class="btn btn-primary" onclick="alert('Send Message clicked')">Send Message</button>
    <button class="btn btn-warning" onclick="alert('Update Status clicked')">Update Status</button>
    </div>
    </section>

    <section id="engagements" class="tab-content" role="tabpanel" aria-labelledby="tab-engagements" hidden>
    <h3>Engagements</h3>
    <nav class="content-tabs" role="tablist" aria-label="Engagement types">
    <button class="content-tab active" role="tab" aria-selected="true" aria-controls="engagement-jobApplications" id="engagement-tab-jobApplications" tabindex="0">Job Applications</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="engagement-practiceLaunchpad" id="engagement-tab-practiceLaunchpad" tabindex="-1">Practice Launchpad</button>
    <button class="content-tab" role="tab" aria-selected="false" aria-controls="engagement-mdCollaborations" id="engagement-tab-mdCollaborations" tabindex="-1">MD Collaborations</button>
    </nav>

    <div id="engagement-jobApplications" class="engagement-subtab-content" role="tabpanel" aria-labelledby="engagement-tab-jobApplications">
    <h4>Job Applications</h4>
    <table id="jobApplicationsTable" aria-label="Job applications related to NP">
    <thead>
    <tr>
    <th>Position</th>
    <th>Status</th>
    <th>Applied Date</th>
    <th>Details</th>
    </tr>
    </thead>
    <tbody>
    <!-- Filled dynamically -->
    </tbody>
    </table>
    </div>

    <div id="engagement-practiceLaunchpad" class="engagement-subtab-content" role="tabpanel" aria-labelledby="engagement-tab-practiceLaunchpad" hidden>
    <h4>Practice Launchpad</h4>
    <p>Business launch in progress.</p>
    <button class="btn btn-primary" onclick="alert('View Practice Launchpad clicked')">View Launchpad</button>
    </div>

    <div id="engagement-mdCollaborations" class="engagement-subtab-content" role="tabpanel" aria-labelledby="engagement-tab-mdCollaborations" hidden>
    <h4>MD Collaborations</h4>
    <table id="mdCollaborationsTable" aria-label="MD collaborations related to NP">
    <thead>
    <tr>
    <th>MD Name</th>
    <th>Status</th>
    <th>Start Date</th>
    <th>Details</th>
    </tr>
    </thead>
    <tbody>
    <!-- Filled dynamically -->
    </tbody>
    </table>
    </div>
    </section>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // Firebase config from your firebase-init.js
    const firebaseConfig = {
      apiKey: "AIzaSyC2MXxO_4Zayv2g8-Az6G9WOoxF2CdrpJ8",
      authDomain: "np-clinical-hub-prototype.firebaseapp.com",
      projectId: "np-clinical-hub-prototype",
      storageBucket: "np-clinical-hub-prototype.appspot.com",
      messagingSenderId: "843798932639",
      appId: "1:843798932639:web:fb768c55f404c25c3306aa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Utility to get query param
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Tab switching logic for main tabs
    const contentTabs = document.querySelectorAll('.content-tab:not(#engagements .content-tab)');
    const tabContents = document.querySelectorAll('.tab-content');

    contentTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        activateContentTab(tab);
      });
      tab.addEventListener('keydown', e => {
        let index = Array.from(contentTabs).indexOf(e.target);
        if (e.key === 'ArrowRight') {
          e.preventDefault();
          const nextIndex = (index + 1) % contentTabs.length;
          activateContentTab(contentTabs[nextIndex]);
          contentTabs[nextIndex].focus();
        } else if (e.key === 'ArrowLeft') {
          e.preventDefault();
          const prevIndex = (index - 1 + contentTabs.length) % contentTabs.length;
          activateContentTab(contentTabs[prevIndex]);
          contentTabs[prevIndex].focus();
        }
      });
    });

    function activateContentTab(selectedTab) {
      contentTabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
        t.setAttribute('tabindex', '-1');
      });
      tabContents.forEach(tc => tc.hidden = true);

      selectedTab.classList.add('active');
      selectedTab.setAttribute('aria-selected', 'true');
      selectedTab.setAttribute('tabindex', '0');
      document.getElementById(selectedTab.getAttribute('aria-controls')).hidden = false;
    }

    // Engagement subtabs logic
    const engagementTabs = document.querySelectorAll('#engagements .content-tab');
    const engagementContents = document.querySelectorAll('.engagement-subtab-content');

    engagementTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        engagementTabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
          t.setAttribute('tabindex', '-1');
        });
        engagementContents.forEach(c => c.hidden = true);

        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        tab.setAttribute('tabindex', '0');
        document.getElementById(tab.getAttribute('aria-controls')).hidden = false;
      });

      tab.addEventListener('keydown', e => {
        let index = Array.from(engagementTabs).indexOf(e.target);
        if (e.key === 'ArrowRight') {
          e.preventDefault();
          const nextIndex = (index + 1) % engagementTabs.length;
          engagementTabs[nextIndex].focus();
          engagementTabs[nextIndex].click();
        } else if (e.key === 'ArrowLeft') {
          e.preventDefault();
          const prevIndex = (index - 1 + engagementTabs.length) % engagementTabs.length;
          engagementTabs[prevIndex].focus();
          engagementTabs[prevIndex].click();
        }
      });
    });

    async function loadNpDetails() {
      const npId = getQueryParam('id');
      if (!npId) {
        alert('No NP / Job Seeker ID specified.');
        window.location.href = 'admin-nps.html';
        return;
      }

      // Load NP document
      const npDocRef = doc(db, 'nps', npId);
      const npDocSnap = await getDoc(npDocRef);
      if (!npDocSnap.exists()) {
        alert('NP / Job Seeker not found.');
        window.location.href = 'admin-nps.html';
        return;
      }
      const np = npDocSnap.data();

      // Populate profile
      document.getElementById('npName').textContent = np.name || '-';
      document.getElementById('npSpecialty').textContent = np.specialty || '-';
      document.getElementById('npCredentials').textContent = np.credentials || '-';
      document.getElementById('npEmail').textContent = np.email || '-';
      document.getElementById('npEmail').href = `mailto:${np.email || ''}`;
      document.getElementById('npPhone').textContent = np.phone || '-';
      document.getElementById('npPhone').href = `tel:${np.phone || ''}`;
      document.getElementById('npLocation').textContent = np.location || '-';
      document.getElementById('npRelocate').textContent = np.willingToRelocate ? 'Yes' : 'No';
      document.getElementById('npExperience').textContent = np.experienceYears || '-';
      const statusEl = document.getElementById('npStatus');
      statusEl.textContent = np.status ? np.status.charAt(0).toUpperCase() + np.status.slice(1) : '-';
      statusEl.className = 'status ' + (np.status ? np.status.toLowerCase() : '');

      // Job Preferences
      document.getElementById('jobType').textContent = np.jobPreferences?.jobType || '-';
      document.getElementById('practiceSettings').textContent = np.jobPreferences?.practiceSettings || '-';
      document.getElementById('availability').textContent = np.jobPreferences?.availability || '-';
      document.getElementById('salary').textContent = np.jobPreferences?.salary || '-';

      // Education
      const educationList = document.getElementById('educationList');
      educationList.innerHTML = '';
      (np.education || []).forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        educationList.appendChild(li);
      });

      // Work History
      const workHistoryList = document.getElementById('workHistoryList');
      workHistoryList.innerHTML = '';
      (np.workHistory || []).forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        workHistoryList.appendChild(li);
      });

      // Licenses
      const licensesList = document.getElementById('licensesList');
      licensesList.innerHTML = '';
      (np.licenses || []).forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        licensesList.appendChild(li);
      });

      // Documents
      const documentsList = document.getElementById('documentsList');
      documentsList.innerHTML = '';
      (np.documents || []).forEach(doc => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${doc.url}" target="_blank" rel="noopener noreferrer">${doc.name}</a>`;
        documentsList.appendChild(li);
      });

      // Application Status & Notes
      document.getElementById('applicationStatusText').textContent = np.applicationStatus || '-';
      document.getElementById('adminNotes').textContent = np.adminNotes || '-';

      // Communication Log
      const commLog = document.getElementById('communicationLog');
      commLog.innerHTML = '';
      (np.communicationLog || []).forEach(entry => {
        const div = document.createElement('div');
        div.className = 'comm-entry';
        div.innerHTML = `<strong>${entry.sender} (${entry.date}):</strong> ${entry.message}`;
        commLog.appendChild(div);
      });

      // Load related job applications
      await loadJobApplications(npId);
      // Load related MD collaborations
      await loadMdCollaborations(npId);
    }

    async function loadJobApplications(npId) {
      const jobAppsTableBody = document.querySelector('#jobApplicationsTable tbody');
      jobAppsTableBody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';

      const q = query(collection(db, 'jobApplications'), where('npId', '==', npId));
      const querySnapshot = await getDocs(q);

      jobAppsTableBody.innerHTML = '';
      if (querySnapshot.empty) {
        jobAppsTableBody.innerHTML = '<tr><td colspan="4">No active applications.</td></tr>';
        return;
      }

      querySnapshot.forEach(docSnap => {
        const app = docSnap.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${app.title || '-'}</td>
          <td>${app.status || '-'}</td>
          <td>${app.appliedDate || '-'}</td>
          <td><a href="admin-job-application-details.html?id=${docSnap.id}" aria-label="View details for ${app.title || 'application'}">View Details</a></td>
        `;
        jobAppsTableBody.appendChild(tr);
      });
    }

    async function loadMdCollaborations(npId) {
      const mdCollabTableBody = document.querySelector('#mdCollaborationsTable tbody');
      mdCollabTableBody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';

      const q = query(collection(db, 'mdCollaborations'), where('npId', '==', npId));
      const querySnapshot = await getDocs(q);

      mdCollabTableBody.innerHTML = '';
      if (querySnapshot.empty) {
        mdCollabTableBody.innerHTML = '<tr><td colspan="4">No active collaboration requests.</td></tr>';
        return;
      }

      querySnapshot.forEach(docSnap => {
        const collab = docSnap.data();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${collab.mdName || '-'}</td>
          <td>${collab.status || '-'}</td>
          <td>${collab.startDate || '-'}</td>
          <td><a href="admin-md-np-collaboration-detail.html?id=${docSnap.id}" aria-label="View details for collaboration with ${collab.mdName || 'MD'}">View Details</a></td>
        `;
        mdCollabTableBody.appendChild(tr);
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadNpDetails();
      activateContentTab(document.querySelector('.content-tab.active'));
    });
  </script>
</body>
</html>